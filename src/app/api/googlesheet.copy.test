const googleApi = {
  transaccion: {
    list: async (name: string): Promise<GoogleSheetResponse[]> => {
      try {
        const response = await fetch(name, { next: { revalidate: 6 } });
        const text = await response.text();

        // console.log("Raw text from Google Sheets:", text);

        // Check if text is in expected format
        if (!text.includes("\t")) {
          // console.error("Data does not seem to be tab-separated.");
          return [];
        }

        const rows = text.trim().split("\n").slice(1);
        // console.log("Rows after splitting:", rows);

        return rows.map((row) => {
          const [fecha, gasto, tipo, skip, fechaIngr, ingreso, tipoIngr] =
            row.split("\t");
          return {
            fecha,
            gasto: parseFloat(gasto),
            tipo,
            fechaIngr,
            ingreso: parseFloat(ingreso),
            tipoIngr,
          };
        });
      } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
        return [];
      }
    },
  },
};

export default googleApi;